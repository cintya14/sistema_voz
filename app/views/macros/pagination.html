{# app/views/macros/pagination.html #}

{% macro render_pagination(pagination, endpoint, almacen='', estado='', search='') %}
    {% if pagination.total_pages > 1 %}
    <nav aria-label="Navegación de páginas" class="mt-4">
        <ul class="pagination justify-content-center mb-0">
            <!-- Primera página -->
            <li class="page-item {% if not pagination.has_prev %}disabled{% endif %}">
                <a class="page-link" href="{% if pagination.has_prev %}{{ url_for(endpoint, page=1, per_page=pagination.per_page, almacen=almacen, estado=estado, search=search) }}{% else %}#{% endif %}" aria-label="Primera">
                    <i class="bi bi-chevron-double-left"></i>
                </a>
            </li>

            <!-- Página anterior -->
            <li class="page-item {% if not pagination.has_prev %}disabled{% endif %}">
                <a class="page-link" href="{% if pagination.has_prev %}{{ url_for(endpoint, page=pagination.prev_num, per_page=pagination.per_page, almacen=almacen, estado=estado, search=search) }}{% else %}#{% endif %}" aria-label="Anterior">
                    <i class="bi bi-chevron-left"></i>
                </a>
            </li>

            <!-- Páginas numeradas -->
            {% set start_page = [1, pagination.page - 2]|max %}
            {% set end_page = [pagination.total_pages, pagination.page + 2]|min %}

            {% if start_page > 1 %}
                <li class="page-item disabled">
                    <span class="page-link">...</span>
                </li>
            {% endif %}

            {% for page_num in range(start_page, end_page + 1) %}
                <li class="page-item {% if page_num == pagination.page %}active{% endif %}">
                    <a class="page-link" href="{{ url_for(endpoint, page=page_num, per_page=pagination.per_page, almacen=almacen, estado=estado, search=search) }}">
                        {{ page_num }}
                    </a>
                </li>
            {% endfor %}

            {% if end_page < pagination.total_pages %}
                <li class="page-item disabled">
                    <span class="page-link">...</span>
                </li>
            {% endif %}

            <!-- Página siguiente -->
            <li class="page-item {% if not pagination.has_next %}disabled{% endif %}">
                <a class="page-link" href="{% if pagination.has_next %}{{ url_for(endpoint, page=pagination.next_num, per_page=pagination.per_page, almacen=almacen, estado=estado, search=search) }}{% else %}#{% endif %}" aria-label="Siguiente">
                    <i class="bi bi-chevron-right"></i>
                </a>
            </li>

            <!-- Última página -->
            <li class="page-item {% if not pagination.has_next %}disabled{% endif %}">
                <a class="page-link" href="{% if pagination.has_next %}{{ url_for(endpoint, page=pagination.total_pages, per_page=pagination.per_page, almacen=almacen, estado=estado, search=search) }}{% else %}#{% endif %}" aria-label="Última">
                    <i class="bi bi-chevron-double-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    {% endif %}
{% endmacro %}


{% macro render_pagination_info(pagination) %}
    <div class="text-muted">
        Mostrando <strong>{{ pagination.start_index }}</strong>
        a <strong>{{ pagination.end_index }}</strong>
        de <strong>{{ pagination.total_items }}</strong> registros
    </div>
{% endmacro %}


{% macro render_per_page_selector(current_per_page, endpoint, almacen='', estado='', search='', id_almacen='') %}
    <div class="d-flex align-items-center">
        <label for="per_page_selector" class="form-label me-2 mb-0">Mostrar:</label>
        <select class="form-select form-select-sm" id="per_page_selector" style="width: auto;" onchange="location.href=this.value;">
            {% for option in [10, 25, 50, 100] %}
            <option value="{{ url_for(endpoint, page=1, per_page=option, almacen=almacen, estado=estado, search=search, id_almacen=id_almacen) }}" {% if current_per_page == option %}selected{% endif %}>
                {{ option }}
            </option>
            {% endfor %}
        </select>
        <span class="ms-2 text-muted">registros</span>
    </div>
{% endmacro %}